<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
  <title>My LIFF app</title>
  <link rel="stylesheet" href="css/style.css" media="all">
</head>

<body>
  <section>
    <h2>LIFF getEnvironment</h2>
    <p id="os"><b>OS:</b> </p>
    <p id="language"><b>Language:</b> </p>
    <p id="version"><b>LIFF Version:</b> </p>
    <p id="lineVersion"><b>Line Version:</b> </p>
    <p id="isInClient"><b>isInClient - LIFF browser:</b> </p>
    <p id="accessToken"><b>AccessToken:</b> </p>
  </section>
  <section>
    <h2>LIFF getProfile</h2>
    <p id="userId"><b>userId:</b> </p>
    <p id="displayName"><b>displayName:</b> </p>
    <p id="statusMessage"><b>statusMessage:</b> </p>
    <p id="decodedIDToken"><b>email:</b> </p>
    <img id="pictureUrl" width="300"> 
  </section>
  <section>
    <h2>LIFF getContext</h2>
    <p id="type"><b>type:</b> </p>
    <p id="viewType"><b>viewType:</b> </p>
    <p id="utouId"><b>utouId:</b> </p>
    <p id="roomId"><b>roomId:</b> </p>
    <p id="groupId"><b>groupId:</b> </p>
  </section>
  <section>
    <h2>LIFF isLoggedIn</h2>
    <p id="isLoggedIn"><b>isLoggedIn:</b> </p>
  </section>
  <section>
    <h2>LIFF URL</h2>
    <h3>createUrl, setExtraQueryParam and openWindow</h3>
    <p id="permanentLink"><b>createUrl:</b> </p>
    <button onclick="openWindow()">Open Window</button>
  </section>
  <section>
    <h2>LIFF getFriendship</h2>
    <p id="friendship"><b>isFriendship:</b> </p>
  </section>

  <!-- <p id="scanCode"><b>Code:</b> </p> -->

  <section>
    <h2>LIFF sendMessages</h2>
    <button id="btnMsg" onclick="sendMsg()">Send Shop Address</button>
    <button id="btnFlexMsg" onclick="sendMsg2()">Send Flex</button>
  </section>
  <section>
    <h2>LIFF shareTargetPicker</h2>
    <button id="btnShare" onclick="shareMsg()">Share Menu</button>
  </section>
  <section>
    <h2>LIFF logout and close</h2>
    <button id="btnLogOut" onclick="logOut()">Log Out</button>
    <button id="btnClose" onclick="closed()">Close Window</button>
  </section>

  <!-- <button id="btnScanCode" onclick="scanCode()">Scan Code</button> -->


  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    function createUniversalLink() {
    }

    async function shareMsg() {
      if (liff.isApiAvailable("shareTargetPicker")) {
        await liff.shareTargetPicker([{
          "type": "template",
          "altText": "Not Available",
          "template": {
            "type": "buttons",
            "thumbnailImageUrl": "https://miro.medium.com/max/1200/1*Wu4CVpHoiarVZQ1013_7rA.png",
            "imageAspectRatio": "square",
            "title": "Click to see our Menu!",
            "text": "Enjoy our drinks",
            "actions": [
              {
                "type": "uri",
                "label": "Menu",
                "uri": "https://lineman.line.me/food-restaurant-list-liff/"
              }
            ]
          }
        }
        ])
      }
      else alert("Please update your app version")
    }

    function logOut() {
      liff.logout()
      window.location.reload()
    }

    function closed() {
      liff.closeWindow()
    }

    // async function scanCode() {
    //   const result = await liff.scanCode()
    //   document.getElementById("scanCode").append(result.value)
    // }

    function openWindow() {
      liff.openWindow({
        "url": "https://lineman.line.me/food/"
      })
    }

    function permanentLink(userId) {
      liff.permanentLink.setExtraQueryParam('user_id=' + userId)
      document.getElementById("permanentLink").append(liff.permanentLink.createUrl())
    }

    async function getFriendship() {
      const friend = await liff.getFriendship()
      document.getElementById("friendship").append(friend.friendFlag)
      if (!friend.friendFlag) {
        if (confirm("You has not add the account, would you like to add now?")) {
          window.location = "https://line.me/ti/p/153pqqsb"
        }
      }
    }

    async function sendMsg() {
      if (liff.getContext().type !== "none") {
        await liff.sendMessages([
          {
            "type": "sticker",
            "stickerId": "52114112",
            "packageId": "11539",
          },
          {
            "type": "text",
            "text": "Hello, here is the shop address",
          },
          {
            "type": "location",
            "title": "My Shop",
            "address": "127 Ratchadamri Road, Lumphini, Pathum Wan, Bangkok, 10330",
            "latitude": 13.746441868712134,
            "longitude": 100.54093455512464
          }
        ])
        alert("Message Sent")
      }
    }

    async function sendMsg2() {
      if (liff.getContext().type !== "none") {
        await liff.sendMessages([{
  "type": "carousel",
  "contents": [
    {
      "type": "bubble",
      "size": "giga",
      "hero": {
        "type": "image",
        "url": "https://krungsrimarket.cjdataservice.com/uploads/campaignpages/campaignpage_banner_t_a28.jpg",
        "size": "full",
        "aspectMode": "cover",
        "aspectRatio": "800:610"
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Honda CBR500",
            "weight": "bold",
            "size": "lg",
            "wrap": true,
            "align": "center"
          },
          {
            "type": "box",
            "layout": "baseline",
            "contents": [
              {
                "type": "text",
                "text": "หรือดาวน์เริ่ม 10,990 บาท* ผ่อนสูงสุด 60 เดือน",
                "size": "xs",
                "align": "center",
                "gravity": "center"
              }
            ]
          },
          {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "baseline",
                "spacing": "xs",
                "contents": [
                  {
                    "type": "text",
                    "text": "สนใจรุ่นนี้ สมัครออนไลน์ได้เลย คลิก!",
                    "size": "md",
                    "align": "center",
                    "color": "#f40001",
                    "gravity": "center"
                  }
                ],
                "paddingAll": "md",
                "paddingTop": "md",
                "offsetTop": "none",
                "paddingBottom": "md",
                "paddingStart": "md",
                "paddingEnd": "md",
                "alignItems": "center",
                "action": {
                  "type": "uri",
                  "label": "action",
                  "uri": "https://kautolink.com/JBLh7D",
                  "altUri": {
                    "desktop": "https://kautolink.com/JBLh7D"
                  }
                }
              }
            ],
            "borderWidth": "none",
            "cornerRadius": "md",
            "justifyContent": "center",
            "alignItems": "center",
            "offsetTop": "none",
            "offsetBottom": "none",
            "offsetStart": "none",
            "offsetEnd": "none",
            "paddingAll": "none",
            "paddingBottom": "none",
            "spacing": "none",
            "margin": "none"
          }
        ],
        "spacing": "sm",
        "paddingAll": "13px"
      }
    },
    {
      "type": "bubble",
      "size": "giga",
      "hero": {
        "type": "image",
        "url": "https://krungsrimarket.cjdataservice.com/uploads/campaignpages/campaignpage_banner_t_f85.jpg",
        "size": "full",
        "aspectMode": "fit",
        "aspectRatio": "800:610"
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Yamaha R7",
            "weight": "bold",
            "size": "xl",
            "wrap": true,
            "align": "center"
          },
          {
            "type": "box",
            "layout": "baseline",
            "contents": [
              {
                "type": "text",
                "text": "หรือดาวน์เริ่ม 0 บาท* ผ่อนสูงสุด 60 เดือน",
                "size": "xs",
                "align": "center",
                "gravity": "center"
              }
            ]
          },
          {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "baseline",
                "spacing": "xs",
                "contents": [
                  {
                    "type": "text",
                    "text": "สนใจรุ่นนี้ สมัครออนไลน์ได้เลย คลิก!",
                    "color": "#f40001",
                    "size": "md",
                    "align": "center",
                    "gravity": "center"
                  }
                ],
                "action": {
                  "type": "uri",
                  "label": "action",
                  "uri": "https://kautolink.com/7b7hIw",
                  "altUri": {
                    "desktop": "https://kautolink.com/7b7hIw"
                  }
                },
                "paddingAll": "md",
                "paddingTop": "md",
                "paddingBottom": "md",
                "paddingStart": "md",
                "paddingEnd": "md",
                "cornerRadius": "md"
              }
            ],
            "spacing": "none",
            "margin": "none",
            "borderWidth": "none",
            "cornerRadius": "md",
            "justifyContent": "center",
            "alignItems": "center",
            "offsetTop": "none",
            "offsetBottom": "none",
            "offsetStart": "none",
            "offsetEnd": "none",
            "paddingAll": "none",
            "paddingBottom": "none"
          }
        ],
        "spacing": "sm",
        "paddingAll": "13px"
      }
    },
    {
      "type": "bubble",
      "size": "giga",
      "hero": {
        "type": "image",
        "url": "https://krungsrimarket.cjdataservice.com/uploads/campaignpages/campaignpage_banner_t_79a.jpg",
        "size": "full",
        "aspectMode": "cover",
        "aspectRatio": "800:610"
      },
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "Triumph Trident 660",
            "weight": "bold",
            "size": "xl",
            "align": "center",
            "gravity": "center"
          },
          {
            "type": "box",
            "layout": "baseline",
            "contents": [
              {
                "type": "text",
                "text": "หรือดาวน์เริ่ม 15,650 บาท* ผ่อนสูงสุด 60 เดือน",
                "size": "xs",
                "align": "center",
                "gravity": "center"
              }
            ],
            "alignItems": "center"
          },
          {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "baseline",
                "spacing": "xs",
                "contents": [
                  {
                    "type": "text",
                    "text": "สนใจรุ่นนี้ สมัครออนไลน์ได้เลย คลิก!",
                    "color": "#f40001",
                    "size": "md",
                    "align": "center",
                    "gravity": "center"
                  }
                ],
                "paddingAll": "md",
                "paddingTop": "md",
                "paddingBottom": "md",
                "paddingStart": "md",
                "paddingEnd": "md",
                "cornerRadius": "md",
                "action": {
                  "type": "uri",
                  "label": "action",
                  "uri": "https://kautolink.com/d6A8jQ",
                  "altUri": {
                    "desktop": "https://kautolink.com/d6A8jQ"
                  }
                }
              }
            ],
            "spacing": "none",
            "margin": "none"
          }
        ],
        "spacing": "sm",
        "paddingAll": "13px"
      }
    }
  ]
}  
          ]
          )
          }
        }


    function getContext() {
      document.getElementById("type").append(liff.getContext().type)
      document.getElementById("viewType").append(liff.getContext().viewType)
      document.getElementById("utouId").append(liff.getContext().utouId)
      document.getElementById("roomId").append(liff.getContext().roomId)
      document.getElementById("groupId").append(liff.getContext().groupId)
    }

    async function getUserProfile() {
      const profile = await liff.getProfile()
      document.getElementById("pictureUrl").src = profile.pictureUrl
      document.getElementById("userId").append(profile.userId)
      document.getElementById("statusMessage").append(profile.statusMessage)
      document.getElementById("displayName").append(profile.displayName)
      document.getElementById("decodedIDToken").append(liff.getDecodedIDToken().email)
      permanentLink(profile.userId)
    }

    function getEnvironment() {
      document.getElementById("os").append(liff.getOS())
      document.getElementById("language").append(liff.getLanguage())
      document.getElementById("version").append(liff.getVersion())
      document.getElementById("lineVersion").append(liff.getLineVersion())
      document.getElementById("accessToken").append(liff.getAccessToken())
      document.getElementById("isInClient").append(liff.isInClient())
    }

    async function main() {
      await liff.init({ liffId: "1656249175-3RKWbNQY" })
      document.getElementById("isLoggedIn").append(liff.isLoggedIn())
      if (liff.isLoggedIn()) {
        getUserProfile()
        getContext()
        getEnvironment()
        getFriendship()
        createUniversalLink()
      } else {
        liff.login()
      }
    }
    main()
  </script>
</body>

</html>